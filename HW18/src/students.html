<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <title>Студенты</title>
    <script>
        /**
         * Функция для обработки введенных значений
         */
        function getDataTable() {
            const table = document.getElementById("studentsTable").getElementsByTagName("tbody")[0];
            const name = document.getElementById("nameInput").value;
            const gender = document.getElementById("genderSelect").value;
            const birthsDayInputValue = document.getElementById("birthsDayInput").value;
            const transformedBornDate = birthsDayInputValue.split('-').reverse().join('.');
            const ageCount = calculateAgeCount(birthsDayInputValue);
            console.log(ageCount, name, gender, birthsDayInputValue)

            if (name) {
                if (name.length < 5 || name.length > 50) {
                    alert("Введено некорректное имя!")
                } else {
                    let inputParams = [name, gender, transformedBornDate, ageCount];
                    addNewRow(table, inputParams);
                }
            } else {
                alert("Имя нужно обязательно заполнить!");
            }
            calculateAverage();
        }

        /**
         *
         * Функция для создания новой строки в таблице студентов
         *
         * @param table - таблица студентов
         * @param params - массив с данными студента
         */
        function addNewRow(table, params) {
            const newRow = table.insertRow(-1);
            for (let i = 0; i < 4; i++) {
                const newCell = document.createElement("td");
                if (i === 3) {
                    newCell.style.textAlign = 'right';
                    newCell.classList.add("ageColumn")
                }
                newCell.innerHTML = params[i];
                newRow.appendChild(newCell);
            }
        }

        /**
         * Функция для расчета возраста студента по дате рождения
         * @param dateString - дата в формате YYYY-DD-MM
         * @returns {number} - количество полных лет
         */
        function calculateAgeCount(dateString) {
            const birthDay = new Date(dateString);
            const age = Math.floor((new Date() - new Date(birthDay)) / 1000 / 60 / 60 / 24 / 365);
            if (age < 0 || age > 100) {
                alert("Введите корректную дату!")
                return 0;
            } else {
                return age;
            }
        }

        /**
         * Функция для подсчета среднего возраста студента
         */
        function calculateAverage() {
            const classes = document.getElementsByClassName("ageColumn");
            let sum = 0;
            if (classes.length > 0) {
                for (let i = 0; i < classes.length; i++) {
                    sum += Number(classes[i].innerHTML);
                }
            }
            let average = Math.floor(sum / classes.length);
            const targetCell = document.getElementById("averageAgeTitle");
            targetCell.innerHTML = average.toString();
        }
    </script>
</head>
<body>
<div class="container">
    <h2>
        Домашняя работа
    </h2>
    <div class="row col-5" style="border: 2px solid black">
        <div class="mt-2">
            <label class="form-label" for="nameInput">Имя студента</label>
            <input class="form-control" id="nameInput" type="text">
        </div>
        <div>
            <label class="form-label" for="birthsDayInput">Имя студента</label>
            <input class="form-control" id="birthsDayInput" type="date">
        </div>
        <div class="mt-2">
            <label for="genderSelect">Пол</label>
            <select class="form-select" id="genderSelect">
                <option selected value="М">Мужчина</option>
                <option value="Ж">Женщина</option>
            </select>
        </div>
        <div class="mt-2 mb-2">
            <button class="btn btn-primary" onclick="getDataTable()">Добавить</button>
        </div>
    </div>
    <div class="row">
        <!--        Таблица студентов-->
        <div class="col-5 mt-5">
            <h3>Таблица студентов</h3>
            <table class="table table-hover" id="studentsTable">
                <thead>
                <tr>
                    <td>Имя студента</td>
                    <td>Пол</td>
                    <td>Дата рождения</td>
                    <td>Возраст</td>
                </tr>
                </thead>

                <tbody>

                </tbody>
                <tfoot>
                <tr>
                    <td>Средний возраст студентов:</td>
                    <td colspan="3" id="averageAgeTitle" style="text-align: right"></td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>

</div>
<!--<script src="/js/source.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"-->
<!--        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"-->
<!--        crossorigin="anonymous"></script>-->
</body>
</html>